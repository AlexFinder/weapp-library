(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{151:function(t,s,a){t.exports=a.p+"assets/img/vue_architecture.500976bc.jpg"},218:function(t,s,a){t.exports=a.p+"assets/img/component.f30eef19.png"},219:function(t,s,a){t.exports=a.p+"assets/img/page_status_indicator.549977f2.png"},220:function(t,s,a){t.exports=a.p+"assets/img/fundebug-2.7aa4e7c5.png"},221:function(t,s,a){t.exports=a.p+"assets/img/fundebug-1.ff5a2a3f.png"},222:function(t,s,a){t.exports=a.p+"assets/img/ui.9838e018.png"},243:function(t,s,a){"use strict";a.r(s);var n=[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"前端"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前端","aria-hidden":"true"}},[this._v("#")]),this._v(" 前端")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"warning custom-block"},[s("p",{staticClass:"custom-block-title"},[this._v("注意")]),s("p",[this._v("本页面为 "),s("strong",[this._v("“在线借书平台”小程序")]),this._v(" 开发文档。")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"tip custom-block"},[n("p",{staticClass:"custom-block-title"},[t._v("TIP")]),n("p",[t._v("桌面应用（尚未开源）："),n("code",[t._v("webpack")]),t._v("+"),n("code",[t._v("vue全家桶")]),t._v("+"),n("code",[t._v("axios")]),t._v("+"),n("code",[t._v("ElementUI")]),t._v("，标准前端开发工作流。"),n("br"),t._v("\n架构图：")]),n("p",[n("img",{attrs:{src:a(151),alt:"vue+webpack"}})])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"ui"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ui","aria-hidden":"true"}},[this._v("#")]),this._v(" UI")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:a(222),alt:"ui"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"技术栈"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#技术栈","aria-hidden":"true"}},[this._v("#")]),this._v(" 技术栈")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("基础库"),s("code",[this._v("1.9.0")]),this._v("以上，尽可能实现"),s("a",{attrs:{href:"#%E7%BB%84%E4%BB%B6%E5%8C%96"}},[this._v("组件化")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"mock-数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mock-数据","aria-hidden":"true"}},[this._v("#")]),this._v(" Mock 数据")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"promise-支持"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#promise-支持","aria-hidden":"true"}},[this._v("#")]),this._v(" Promise 支持")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("部分操作系统下的小程序不支持"),s("code",[this._v("Promise")]),this._v("，因此需要引入第三方库。由于小程序不支持 dom，因此不能用"),s("code",[this._v("bluebird.js")]),this._v("，只能用"),s("code",[this._v("es6-promise.js")]),this._v("。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"api-promise化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#api-promise化","aria-hidden":"true"}},[this._v("#")]),this._v(" API Promise化")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("小程序 API 都是以回调函数的形式提供。为了提高代码可读性，采用以下方法将小程序原始 API 封装成支持 "),s("code",[this._v("Promise")]),this._v(" 的 API：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-JS extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// utils/promisify.js")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("Promisify")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fn"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("Promise")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("resolve"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" reject"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      obj"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function-variable function"}},[t._v("success")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{attrs:{class:"token function"}},[t._v("resolve")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      obj"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function-variable function"}},[t._v("fail")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{attrs:{class:"token function"}},[t._v("reject")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{attrs:{class:"token function"}},[t._v("fn")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-JS extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Promisify "),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'utils/promisify'")]),t._v("\n"),a("span",{attrs:{class:"token function"}},[t._v("Promisify")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("wx"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("scan"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  type"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'bar'")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("then")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("catch")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" console"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("error")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"添加-finally-方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#添加-finally-方法","aria-hidden":"true"}},[this._v("#")]),this._v(" 添加"),s("code",[this._v(".finally()")]),this._v("方法")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-JS extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// 1. 在 /utils/promise-polyfill.js 内引入 Promise 对象")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" Promise "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'./es6-promise.js'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 2. 在 app.js 依次引入 es6-promise，promise-polyfill")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Promise "),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'./utils/es6-promise'")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" promisePolyfill "),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'./utils/promise-polyfill'")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"网络请求"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#网络请求","aria-hidden":"true"}},[this._v("#")]),this._v(" 网络请求")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"request-基类方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#request-基类方法","aria-hidden":"true"}},[this._v("#")]),this._v(" request 基类方法")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-JS extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// 远程服务器")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("BASE_URL")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'https://www.library-online.cn/api/public/index.php/api'")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 本地服务器")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// export const BASE_URL = 'http://localhost:8080/library/public/index.php/api'")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("/**\n * request 基类方法\n * 状态码 ≥ 400 时，返回 rejected 状态的 promise\n * @param method 请求方式 必填\n * @param relativeUrl 相对路径 必填\n * @param param 参数 可选\n * @param header 请求头参数 可选\n * @returns {Promise} 返回响应完整内容\n */")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("request")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("method"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" relativeUrl"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" param"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" header"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" response"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" error\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("Promise")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("resolve"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" reject"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    wx"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("request")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      url"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("BASE_URL")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v(" relativeUrl"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      method"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" method"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      header"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Object"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("assign")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{attrs:{class:"token string"}},[t._v("'Content-Type'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'application/json'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{attrs:{class:"token string"}},[t._v("'TOKEN'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("getToken")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("// 添加用户token")]),t._v("\n      "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" header"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      data"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" param "),a("span",{attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{attrs:{class:"token function"}},[t._v("success")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        response "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" res"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data\n        "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("statusCode "),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("400")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),a("span",{attrs:{class:"token function"}},[t._v("resolve")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),a("span",{attrs:{class:"token function"}},[t._v("reject")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{attrs:{class:"token function"}},[t._v("fail")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        error "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" err\n        "),a("span",{attrs:{class:"token function"}},[t._v("reject")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{attrs:{class:"token function"}},[t._v("complete")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{attrs:{class:"token comment"}},[t._v("// 这里打印请求结果")]),t._v("\n      "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("本项目的开发环境部署在本地，生产环境部署在腾讯云，测试数据来自 Easy Mock。为方便调试，设置"),s("code",[this._v("BASE_URL")]),this._v("变量，这样只需要切换注释就可以方便地更改 API 基址，见上面代码第 2 行（第一处高亮）。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[a("code",[t._v("wx.request")]),t._v("方法只要得到服务器响应，无论服务器的状态码是多少，都会走"),a("code",[t._v("success")]),t._v("回调，因此第 28-32 行（第三处高亮）判断服务器返回的状态码，当状态码 ≥"),a("code",[t._v("400")]),t._v("时，返回"),a("code",[t._v("Promise.reject()")]),t._v("。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"requestwithmodal-方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#requestwithmodal-方法","aria-hidden":"true"}},[this._v("#")]),this._v(" requestWithModal 方法")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("每次请求失败时，以模态框的形式显示错误信息，见"),s("a",{attrs:{href:"#%E5%87%BA%E9%94%99%E5%A4%84%E7%90%86"}},[this._v("出错处理")]),this._v("。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"get-post-del-方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#get-post-del-方法","aria-hidden":"true"}},[this._v("#")]),this._v(" get / post / del 方法")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[t._v("在"),a("a",{attrs:{href:"#%E6%98%BE%E7%A4%BA%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF"}},[t._v(" requestWithModal ")]),t._v("方法的基础上封装了"),a("code",[t._v("get")]),t._v("、"),a("code",[t._v("post")]),t._v("、"),a("code",[t._v("del")]),t._v("方法，每次发起请求都不需要单独写"),a("code",[t._v("catch()")]),t._v("语句，请求失败时会自动显示错误信息。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"出错处理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#出错处理","aria-hidden":"true"}},[this._v("#")]),this._v(" 出错处理")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"错误监控"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#错误监控","aria-hidden":"true"}},[this._v("#")]),this._v(" 错误监控")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Fundebug 是全栈 JavaScript 错误实时监控平台。"),s("strong",[this._v("当用户应用出现错误时，Fundebug 会通过邮件或者第三方工具立即给开发者发送报警")]),this._v("，这样能够帮助开发者及时发现并且解决应用错误，从而提升用户体验。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"接入方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#接入方式","aria-hidden":"true"}},[this._v("#")]),this._v(" 接入方式")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",[s("li",[this._v("下载 Fundebug 微信小程序插件 "),s("code",[this._v("fundebug.0.5.0.min.js")])]),s("li",[this._v("在"),s("code",[this._v("app.js")]),this._v("中引入并配置"),s("code",[this._v("apikey")]),this._v(":")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-JS extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" fundebug "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'/utils/fundebug.0.5.0.min.js'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nfundebug"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("apikey "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'XXXXXX'")]),t._v("\nfundebug"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("setSystemInfo "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("// 报警时收集用户设备信息")]),t._v("\nfundebug"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("releaseStage "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'production'")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"3"}},[s("li",[this._v("将"),s("code",[this._v("https://fundebug.com")]),this._v("添加到 request 合法域名")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"控制台截图"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#控制台截图","aria-hidden":"true"}},[this._v("#")]),this._v(" 控制台截图")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:a(221),alt:"fundebug"}}),s("img",{attrs:{src:a(220),alt:"fundebug"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"显示错误信息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#显示错误信息","aria-hidden":"true"}},[this._v("#")]),this._v(" 显示错误信息")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("为了友好地向"),s("strong",[this._v("小程序用户")]),this._v("展示错误信息，本项目小程序将"),s("code",[this._v("request")]),this._v("进一步封装为"),s("code",[this._v("requestWithModal")]),this._v("方法。每次网络请求失败时，以模态框的形式告知用户发生了什么错误，代码如下：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-JS extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("/**\n * 请求失败时，显示服务器的错误信息(data.message)或微信的错误信息(errMsg)\n */")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("requestWithModal")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("method"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" relativeUrl"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" param"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" header"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("request")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("method"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" relativeUrl"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" param"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" header"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("catch")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" errMsg\n      "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("statusCode "),a("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("401")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{attrs:{class:"token function"}},[t._v("showLoginModal")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data "),a("span",{attrs:{class:"token operator"}},[t._v("&&")]),t._v(" res"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("message"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          errMsg "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" res"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("message\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          errMsg "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" res"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("statusCode "),a("span",{attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'发生未知错误，请联系开发者'")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" res"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("errMsg\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        wx"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("showModal")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          content"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" errMsg"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          showCancel"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" Promise"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("reject")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ol",[a("li",[t._v("当服务器返回"),a("code",[t._v("401")]),t._v("状态码时，显示模态框引导用户登录（第8-10行）")]),a("li",[t._v("当服务器返回错误对象时，"),a("code",[t._v("res.data")]),t._v("属性中会有"),a("code",[t._v("message")]),t._v("属性，显示该错误信息（第11-13行）")]),a("li",[t._v("当得到服务器响应，但服务器没有附带错误信息"),a("code",[t._v("message")]),t._v("时，显示"),a("code",[t._v("发生未知错误，请联系开发者")]),t._v("（第 14 行前半句）")]),a("li",[t._v("当没有得到服务器响应时，比如没信号或者加载时间过长，显示小程序框架返回的错误信息"),a("code",[t._v("errMsg")]),t._v("（第 14 行后半句）")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"页面重新加载"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#页面重新加载","aria-hidden":"true"}},[this._v("#")]),this._v(" 页面重新加载")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:a(219),alt:"页面加载器"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",[s("li",[this._v("在页面"),s("code",[this._v("wxml")]),this._v("中引入模板")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-HTML extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("import")]),t._v(" "),a("span",{attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{attrs:{class:"token punctuation"}},[t._v('"')]),t._v("/templates/page-status-indicator/index"),a("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("template")]),t._v(" "),a("span",{attrs:{class:"token attr-name"}},[t._v("data")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{attrs:{class:"token punctuation"}},[t._v('"')]),t._v("{{pageStatus}}"),a("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{attrs:{class:"token attr-name"}},[t._v("is")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{attrs:{class:"token punctuation"}},[t._v('"')]),t._v("page-status-indicator"),a("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("template")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("block")]),t._v(" "),a("span",{attrs:{class:"token attr-name"}},[a("span",{attrs:{class:"token namespace"}},[t._v("wx:")]),t._v("if")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{attrs:{class:"token punctuation"}},[t._v('"')]),t._v("{{pageStatus == "),a("span",{attrs:{class:"token punctuation"}},[t._v("'")]),t._v("done"),a("span",{attrs:{class:"token punctuation"}},[t._v("'")]),t._v("}}"),a("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{attrs:{class:"token comment"}},[t._v("\x3c!-- 这里是页面所有内容 --\x3e")]),t._v("\n"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("block")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ol",{attrs:{start:"2"}},[a("li",[t._v("在页面"),a("code",[t._v("js")]),t._v("中声明"),a("code",[t._v("pageStatus")]),t._v("属性与"),a("code",[t._v("onPageReload")]),t._v("方法")]),a("li",[t._v("在加载数据的方法中设置"),a("code",[t._v("pageStatus")]),t._v("属性")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-JS extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token function"}},[t._v("Page")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  data"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token comment"}},[t._v("/**\n     * 页面状态\n     * loading：加载中\n     * error：获取数据失败，显示重新加载按钮\n     * done：成功，显示页面内容\n     */")]),t._v("\n    pageStatus"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'loading'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token comment"}},[t._v("// 其他数据")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// 加载页面")]),t._v("\n  onLoad"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("options"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("this")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("_loadPage")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// 重新加载页面")]),t._v("\n  onReloadPage"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("this")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("_loadPage")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n  _loadPage"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token function"}},[t._v("getBook")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("then")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{attrs:{class:"token keyword"}},[t._v("this")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("setData")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("pageStatus"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'done'")]),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("catch")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{attrs:{class:"token keyword"}},[t._v("this")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("setData")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("pageStatus"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'error'")]),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// 其他方法")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"跨页面通信"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#跨页面通信","aria-hidden":"true"}},[this._v("#")]),this._v(" 跨页面通信")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",[s("li",[s("code",[this._v("app.js")]),this._v("引入事件总线")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" EventEmitter "),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'./utils/event'")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("// 事件总线")]),t._v("\n"),a("span",{attrs:{class:"token function"}},[t._v("App")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// 全局事件总线")]),t._v("\n  event"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("EventEmitter")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"2"}},[s("li",[this._v("在页面"),s("code",[this._v("onLoad")]),this._v("文件内监听事件")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-JS extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("/**\n * /pages/profile/children/order-ongoing.js\n * @listens <orderCanceled>\n * 事件在订单详情页(./children/order-detail)中被触发\n */")]),t._v("\nonLoad"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// 监听事件")]),t._v("\n  app"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("event"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("on")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'orderCanceled'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("this")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("onOrderCanceled"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 事件回调函数")]),t._v("\nonOrderCanceled"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("order"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"3"}},[s("li",[this._v("在其他页面触发事件")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-JS extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// pages/profile/children/children/order-detail.js")]),t._v("\n_onAction"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("order"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token function"}},[t._v("func")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token constant"}},[t._v("ORDER_ID")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("then")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    app"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("event"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("emit")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'orderCanceled'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" order "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("finally")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" wx"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("hideLoading")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"组件化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#组件化","aria-hidden":"true"}},[this._v("#")]),this._v(" 组件化")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:a(218),alt:"组件展示"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"文件结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#文件结构","aria-hidden":"true"}},[this._v("#")]),this._v(" 文件结构")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v(".\n├── apis                  // 网络请求\n│   ├── request.js        // get/post/delete封装\n│   ├── book.js           // /books api封装\n│   └── xxx.js            // /xxxs api封装\n├── app.js\n├── app.json\n├── app.wxss\n├── component-demos       // 组件展示\n├── components            // 可复用组件\n│   ├── async-button      // 异步按钮\n│   ├── async-switch      // 异步切换器\n│   ├── collapse          // 可折叠容器\n│   ├── load-more         // 加载更多\n│   ├── no-data           // 暂无数据\n│   ├── panel             // 带导航标题的面板\n│   ├── popup             // 底部弹出层\n│   ├── rate              // 可评半星的评分组件\n│   ├── search-bar        // 带遮罩的搜索框\n│   ├── send-code         // 发送验证码按钮\n│   ├── spinner           // 加载中动画\n│   ├── sticky            // 固定页头\n│   ├── sticky-2          // 固定页头的另一种实现\n│   ├── tab-bar           // 标签页\n│   ├── toast             // 弹出提示\n│   └── toptip            // 顶部提示\n├── images                // 图标\n├── package.json\n├── pages                 // 页面，子页面在父页面的children文件夹中\n│ └─components            // 与业务相关的特殊组件\n├── project.config.json\n├── styles                // 样式\n├── templates             // 模板\n│   ├── library-list      // 图书馆列表\n│   ├── page-status-indicator // 页面加载状态，带有一个“重新加载”按钮\n│   └── showcase          // 图书项目\n└── utils                 // 辅助模块\n    ├── biz-helper.wxs    // 业务相关辅助函数，用于wxml中\n    ├── constant.js       // 业务常量\n    ├── constant.wxs      // 业务常量，用于wxml中\n    ├── es6-promise.js    // Promise语法支持\n    ├── event.js          // 全局事件\n    ├── permission.js     // 登录鉴权\n    ├── promise-polyfill.js // Promise.finally()语法\n    ├── promisify.js      // 微信小程序API Promise化\n    ├── qrcode.js         // 二维码生成\n    ├── tip.js            // 使用帮助\n    ├── utils.js          // 辅助函数\n    ├── validator.js      // 正则校验器\n    └── fundebug.js       // 错误监控\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"代码规范"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#代码规范","aria-hidden":"true"}},[this._v("#")]),this._v(" 代码规范")])}],e=a(0),r=Object(e.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[t._m(0),t._m(1),t._m(2),t._m(3),a("p",[t._v("利用原型工具 Sketch 与 WeUI 设计工具包，设计了完整的界面原型。遵守 WeUI 视觉规范，对字体大小、列表间距、颜色方案等做了清晰的约定。"),a("router-link",{attrs:{to:"./feature.html#运行截图"}},[t._v("点击查看")]),t._v("更多运行截图，"),a("a",{attrs:{href:t.$withBase("/ui.sketch")}},[t._v("点此下载")]),t._v("小程序设计稿。")],1),t._m(4),t._m(5),t._m(6),t._m(7),a("p",[t._v("本项目采用前后端分离开发。前端采用"),a("a",{attrs:{href:"https://www.easy-mock.com/project/5aacc9a1d3f6bd35dfb4be65",target:"_blank",rel:"noopener noreferrer"}},[t._v("Easy Mock"),a("OutboundLink")],1),t._v("作为 Mock 数据服务器，利用"),a("code",[t._v("Mock.js")]),t._v("生成模拟数据。Easy Mock 是一个纯前端可视化，并且能快速生成模拟数据的持久化服务，可以结合 Swagger 自动生成 API 定义，集成了"),a("code",[t._v("Mock.js")]),t._v("。")]),t._m(8),t._m(9),t._m(10),t._m(11),t._m(12),a("p",[t._v("使用方法：")]),t._m(13),t._m(14),a("p",[t._v("见"),a("a",{attrs:{href:"https://github.com/imageslr/weapp-library/tree/master/utils/promise-polyfill.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("promise-polyfill.js"),a("OutboundLink")],1),t._v("。具体方法如下：")]),t._m(15),t._m(16),a("p",[t._v("为了方便管理和维护，小程序项目根据"),a("a",{attrs:{href:"https://app.swaggerhub.com/apis/imageslr/weapp/1.0.1#/",target:"_blank",rel:"noopener noreferrer"}},[t._v("API 文档定义"),a("OutboundLink")],1),t._v("，按照"),a("code",[t._v("Model")]),t._v("维度，将小程序的网络请求划分为 9 个模块，共 50 余个接口，见"),a("a",{attrs:{href:"https://github.com/imageslr/weapp-library/tree/master/apis/",target:"_blank",rel:"noopener noreferrer"}},[t._v("GitHub"),a("OutboundLink")],1),t._v("。")]),t._m(17),a("p",[t._v("小程序项目在"),a("a",{attrs:{href:"https://github.com/imageslr/weapp-library/tree/master/apis/request.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("request.js"),a("OutboundLink")],1),t._v("中封装了"),a("code",[t._v("request")]),t._v("方法，提供"),a("code",[t._v("request拦截")]),t._v("、"),a("code",[t._v("response拦截")]),t._v("、"),a("code",[t._v("统一的错误处理")]),t._v("、"),a("code",[t._v("BASE_URL设置")]),t._v("等功能，返回"),a("code",[t._v("Promise")]),t._v("对象，代码如下：")]),t._m(18),t._m(19),a("p",[t._v("在之前的文档中提到过：客户端存储 token，之后访问每一个 API 时必须在"),a("code",[t._v("header")]),t._v("中添加"),a("code",[t._v("TOKEN")]),t._v("字段（见"),a("router-link",{attrs:{to:"./back.html#安全机制"}},[t._v("后端-安全机制")]),t._v("），因此第 23 行（第二处高亮）在"),a("strong",[t._v("每个请求")]),t._v("的"),a("code",[t._v("header")]),t._v("中添加了"),a("code",[t._v("TOKEN")]),t._v("字段。")],1),t._m(20),t._m(21),t._m(22),t._m(23),t._m(24),t._m(25),t._m(26),a("p",[t._v("小程序在运行时会出现许多不可预知的错误，本项目采用"),a("a",{attrs:{href:"https://docs.fundebug.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v(" Fundebug "),a("OutboundLink")],1),t._v("监控小程序的运行时错误，并在出现错误时以邮件形式向"),a("strong",[t._v("开发者")]),t._v("发送报警。")]),t._m(27),t._m(28),t._m(29),t._m(30),t._m(31),t._m(32),a("p",[t._v("如下图，错误信息中包含设备信息、错误栈及统计数据。")]),t._m(33),t._m(34),a("p",[t._v("在之前的文档中提到过：当 API 响应错误时，服务器会返回错误状态码( > 400)以及一个错误对象（见"),a("router-link",{attrs:{to:"./api.html#错误对象"}},[t._v("API-错误对象")]),t._v(")，其中包含给用户看的错误信息"),a("code",[t._v("message")]),t._v("。")],1),t._m(35),t._m(36),a("p",[t._v("其中第 8-15 行的作用是：")]),t._m(37),t._m(38),a("p",[t._v("本项目使用"),a("a",{attrs:{href:"https://github.com/imageslr/weapp-library/tree/master/templates/page-status-indicator/index.wxml#L37-L54",target:"_blank",rel:"noopener noreferrer"}},[t._v("页面加载器"),a("OutboundLink")],1),t._v("模板表示页面加载状态，当页面加载失败时，用户可以直接点击"),a("code",[t._v("重新加载")]),t._v("刷新页面。")]),t._m(39),a("p",[t._v("使用方法如下：")]),t._m(40),t._m(41),t._m(42),t._m(43),t._m(44),a("p",[t._v("本项目需要多个场合下跨页面通信，比如这样的业务场景：用户首先进入订单列表页。然后点击其中一个订单，进入到订单详情页。当用户在订单详情页对订单进行操作，例如删除订单、续借图书时，该订单的状态就会发生改变。此时需要更新上一级的订单列表页中该订单的状态。")]),a("p",[t._v("本项目通过"),a("a",{attrs:{href:"https://github.com/Gozala/events",target:"_blank",rel:"noopener noreferrer"}},[t._v(" Node.js Event 库"),a("OutboundLink")],1),t._v("实现跨页面通信，"),a("code",[t._v("Node.js Event")]),t._v("模块是 Node.js 的核心模块之一，实现了"),a("strong",[t._v("发布-订阅模式")]),t._v("的通信机制。具体方法如下：")]),t._m(45),t._m(46),t._m(47),t._m(48),t._m(49),t._m(50),t._m(51),a("p",[t._v("在线借书平台小程序——我的——组件展示")]),t._m(52),t._m(53),a("p",[a("a",{attrs:{href:"https://github.com/imageslr/weapp-library",target:"_blank",rel:"noopener noreferrer"}},[t._v("在 GitHub 上查看"),a("OutboundLink")],1)]),t._m(54),t._m(55),a("p",[t._v("遵循 "),a("a",{attrs:{href:"https://standardjs.com/readme-zhcn.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("JavaScript Standard Style"),a("OutboundLink")],1)])])},n,!1,null,null,null);s.default=r.exports}}]);